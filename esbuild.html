<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document Explorer with Word Cloud</title>
  <style></style>
  <script type="text/babel" data-path="main.ts">
    import * as React from "react";
    import { createRoot } from 'react-dom/client';
    import { Card, Row, Col } from 'antd';
    import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';

    const stockData = [
      { name: 'Jan', price: 100 },
      { name: 'Feb', price: 120 },
      { name: 'Mar', price: 90 },
      { name: 'Apr', price: 110 },
      { name: 'May', price: 130 },
      { name: 'Jun', price: 115 },
    ];

    function App() {
      return (
        <div style={{ padding: '20px' }}>
          <h1>Stock Market</h1>
          <Row gutter={16}>
            <Col span={12}>
              <Card title="Stock Price Chart">
                <LineChart width={500} height={300} data={stockData}>
                  <XAxis dataKey="name" />
                  <YAxis />
                  <CartesianGrid stroke="#eee" strokeDasharray="5 5" />
                  <Tooltip />
                  <Legend />
                  <Line type="monotone" dataKey="price" stroke="#8884d8" />
                </LineChart>
              </Card>
            </Col>
            <Col span={12}>
              <Card title="Stock Details">
                <p>Company: ABC Inc.</p>
                <p>Current Price: $115</p>
                <p>Volume: 100,000</p>
                <p>Market Cap: $1,000,000</p>
              </Card>
            </Col>
          </Row>
        </div>
      );
    }

    createRoot(document.getElementById('root')).render(<App />);
  </script>

  <script>
    const babelText = document.querySelector("script[type='text/babel']").textContent;
    const importFromPattern = /import\s+(.+)\s+from\s+['"](.+)['"]/g;

    const importMatches = [...babelText.matchAll(importFromPattern)];
    const importFroms = importMatches.map(m => m[2]);
    const importMap = Object.fromEntries(importFroms.map(from => [
      from,
      `https://esm.sh/${from}?external=react`
    ]));
    console.log(importMap);

    const importMapsContent = {
      imports: {
        ...importMap,
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
      }
    }
    const importMapsScript = document.createElement("script");
    importMapsScript.type = "importmap";
    importMapsScript.textContent = JSON.stringify(importMapsContent, null, 2);
    document.currentScript.after(importMapsScript);
  </script>

  <script src="./node_modules/esbuild-wasm/lib/browser.js"></script>

  <script type="module">


    await esbuild.initialize({
      wasmURL: './node_modules/esbuild-wasm/esbuild.wasm',
    });

    // build file content map
    const virtualFiles = Object.fromEntries([...document.querySelectorAll(`script[type="text/babel"]`)].map(s => ([
      s.getAttribute("data-path"),
      s.textContent
    ])));

    const result = await esbuild.transform(virtualFiles["main.ts"], { loader: "tsx" });
    console.log(result);
    const sourceScript = document.querySelector(`script[data-path="main.ts"]`);
    const transpiledScript = document.createElement("script");
    transpiledScript.textContent = result.code;
    transpiledScript.type = "module";

    document.head.appendChild(importMapsScript);

    sourceScript.insertAdjacentElement("afterend", transpiledScript);
  </script>
</head>

<body>
  <div id="root"></div>



</body>

</html>