<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document Explorer with Word Cloud</title>
  <style></style>
  <script type="text/babel" data-path="main.ts">
    import * as React from "react";
    import { createRoot } from "react-dom/client";
    import { Form, Input, Button, TimePicker, List, Card } from 'antd';
    import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend } from 'recharts';
    import moment from 'moment';

    const { useState } = React;

    function App() {
      const [signUps, setSignUps] = useState([]);
      const [form] = Form.useForm();

      const onFinish = (values) => {
        const newSignUp = {
          name: values.name,
          time: values.time.format('HH:mm')
        };
        setSignUps([...signUps, newSignUp]);
        form.resetFields();
      };

      const data = signUps.map(signUp => ({
        name: signUp.name,
        time: signUp.time
      }));

      return (
        <div style={{ padding: '20px' }}>
          <Card title="Boat House Daily Schedule Sign-Up">
            <Form form={form} onFinish={onFinish} layout="inline">
              <Form.Item
                name="name"
                rules={[{ required: true, message: 'Please input your name!' }]}
              >
                <Input placeholder="Name" />
              </Form.Item>
              <Form.Item
                name="time"
                rules={[{ required: true, message: 'Please select a time!' }]}
              >
                <TimePicker format="HH:mm" />
              </Form.Item>
              <Form.Item>
                <Button type="primary" htmlType="submit">
                  Sign Up
                </Button>
              </Form.Item>
            </Form>
          </Card>
          <Card title="Sign-Ups" style={{ marginTop: '20px' }}>
            <List
              dataSource={signUps}
              renderItem={item => (
                <List.Item>
                  {item.name} - {item.time}
                </List.Item>
              )}
            />
          </Card>
          <Card title="Sign-Ups Chart" style={{ marginTop: '20px' }}>
            <BarChart
              width={600}
              height={300}
              data={data}
              margin={{
                top: 5, right: 30, left: 20, bottom: 5,
              }}
            >
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis dataKey="name" />
              <YAxis />
              <Tooltip />
              <Legend />
              <Bar dataKey="time" fill="#8884d8" />
            </BarChart>
          </Card>
        </div>
      );
    }

    createRoot(document.getElementById("root")).render(<App />);
  </script>

  <script>
    const babelText = document.querySelector("script[type='text/babel']").textContent;
    const importFromPattern = /import\s+(.+)\s+from\s+['"](.+)['"]/g;

    const importMatches = [...babelText.matchAll(importFromPattern)];
    const importFroms = importMatches.map(m => m[2]);
    const importMap = Object.fromEntries(importFroms.map(from => [
      from,
      `https://esm.sh/${from}?external=react`
    ]));
    console.log(importMap);

    const importMapsContent = {
      imports: {
        ...importMap,
        "react": "https://esm.sh/react@18.3.1",
        "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
      }
    }
    const importMapsScript = document.createElement("script");
    importMapsScript.type = "importmap";
    importMapsScript.textContent = JSON.stringify(importMapsContent, null, 2);
    document.currentScript.after(importMapsScript);
  </script>

  <script src="./node_modules/esbuild-wasm/lib/browser.js"></script>

  <script type="module">


    await esbuild.initialize({
      wasmURL: './node_modules/esbuild-wasm/esbuild.wasm',
    });

    // build file content map
    const virtualFiles = Object.fromEntries([...document.querySelectorAll(`script[type="text/babel"]`)].map(s => ([
      s.getAttribute("data-path"),
      s.textContent
    ])));

    const result = await esbuild.transform(virtualFiles["main.ts"], { loader: "tsx" });
    console.log(result);
    const sourceScript = document.querySelector(`script[data-path="main.ts"]`);
    const transpiledScript = document.createElement("script");
    transpiledScript.textContent = result.code;
    transpiledScript.type = "module";

    document.head.appendChild(importMapsScript);

    sourceScript.insertAdjacentElement("afterend", transpiledScript);
  </script>
</head>

<body>
  <div id="root"></div>



</body>

</html>